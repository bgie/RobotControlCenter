<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="static/bootstrap.min.css" rel="stylesheet" media="screen">
    <script type="text/javascript" src="static/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="static/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
      $(document).ready(function(){
          var socket = io("{{ namespace }}");
          socket.on('connect', function(msg) {
          });
          socket.on('script_started', function(){
              $('#script_output').html('')
              $('#abort_button').removeAttr('disabled')
          });
          socket.on('script_output', function(msg){
              $('#script_output').append(msg)
          });
          socket.on('script_finished', function(exit_code){
              var color = (exit_code==0) ? 'green' : 'red'
              $('#script_output').append('<font color="' + color + '">The script finished with exit code ' + exit_code + '</font>')
              $('#run_button').removeAttr('disabled')
              $('#abort_button').attr('disabled',true);
          });
          $('#run_button').on('click', function(e) {
            e.preventDefault()
            $(this).attr('disabled',true);
            socket.emit('run_script', $('#script_textarea').val())
          });
          $('#abort_button').on('click', function(e) {
            e.preventDefault()
            socket.emit('abort_script')
          });
      });
  </script>
  </head>
  <body>
    <div class="container">
      <h1>Welcome {{ session['username']|e }} </h1>
      <a href="{{ url_for('logout')}}">Logout</a>

      <form action="/form/submit" method="GET">
        <!-- TODO check out https://ace.c9.io/ -->
        <textarea id=script_textarea rows="25" cols="120" name="script" style="font-family:monospace;" spellcheck="false">{{ script_code }}</textarea>
        <br/>
        <button id=run_button type="submit" class='btn btn-default'>Run</button>
        <button id=abort_button type="submit" class='btn' disabled="true">Abort</button>
      </form>
      <pre id='script_output'></pre>
    </div>
  </body>
</html>
